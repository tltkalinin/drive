{% extends 'base.html' %}

{% block title %}
Бронирование
{% endblock %}

{% block body %}
<div class="container">
    <div class="card shadow-lg rounded-4 p-4 bg-dark text-light">
        <h2 class="text-center mb-4">Форма бронирования</h2>
        <form id="bookingForm" method="POST">
            <!-- Дата и время -->
            <div class="row mb-3">
                <div class="col">
                    <label class="form-label">Дата</label>
                    <input type="date" id="dateInput" name="date" class="form-control" required>
                </div>
                <div class="col">
                    <label class="form-label">Время начала</label>
                    <select name="time" class="form-select" required>
                        <option value="">Выберите время</option>
                        {% for h in range(0, 24) %}
                        {% set hour = "%02d:00" % h %}
                        <option value="{{ hour }}">{{ hour }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Длительность -->
            <div class="mb-3">
                <label class="form-label">Длительность</label>
                <select class="form-select" name="duration" required>
                    <option value="">Выберите</option>
                    <option value="1">1 час</option>
                    <option value="2">2 часа</option>
                    <option value="3">3 часа</option>
                    <option value="4">4 часа</option>
                    <option value="5">5 часов</option>
                    <option value="6">6 часов</option>
                    <option value="night">Ночной пакет (22:00–10:00)</option>
                    <option value="12h">пакет 12 часов</option>
                    <option value="24h">пакет 24 часа</option>
                </select>
                <div class="form-check mt-2">
                    <input class="form-check-input" type="checkbox" name="auto_extend" id="auto_extend">
                    <label class="form-check-label" for="auto_extend">Автопродление (до 12ч всего вместе с изначальным
                        временем)</label>
                </div>
            </div>

            <!-- Зона -->
            <div class="mb-3">
                <label class="form-label">Игровая зона</label>
                <select class="form-select" name="zone" id="zone" required>
                    <option value="">Выберите</option>
                    <option value="pc">PC</option>
                    <option value="ps">PlayStation</option>
                    <option value="xbox">X-box</option>
                    <option value="vr">VR</option>
                </select>
            </div>

            <!-- Подзона -->
            <div class="mb-3">
                <label class="form-label">Подзона</label>
                <select class="form-select" name="subzone" id="subzone" required>
                    <!-- варианты будут подставляться скриптом -->
                </select>
            </div>

            <!-- Динамический выбор номера -->
            <div class="mb-3" id="placeWrapper" style="display: none;">
                <label class="form-label" id="placeLabel"></label>
                <div id="placeGrid" class="d-flex flex-wrap gap-2 mt-2"></div>
                <input type="hidden" name="place" id="placeSelect">
            </div>

            <!-- Сумма заказа -->
            <div class="mb-3" id="orderTotalWrapper" style="display:none;">
                <label class="form-label fw-bold">Сумма заказа:</label>
                <div id="orderTotal" class="p-2 border rounded bg-secondary text-light fs-5">0 ₽</div>
            </div>

            <!-- Комментарий -->
            <div class="mb-3">
                <label class="form-label">Комментарий</label>
                <textarea name="comment" class="form-control" rows="2" placeholder="Ваши пожелания..."></textarea>
            </div>

            <!-- Оплата -->
            <div class="mb-3">
                <label class="form-label">Способ оплаты</label>
                <select class="form-select" name="payment" id="payment" required>
                    <option value="">Выберите</option>
                    <option value="online">Онлайн</option>
                    <option value="club">В клубе</option>
                </select>
            </div>

            <div class="text-center mt-2" id="payButtonWrapper" style="display:none;">
                <button type="button" class="btn btn-success px-5 py-2" id="openPaymentBtn">Оплатить</button>
            </div>
            <div class="text-center mt-2" id="paidLabelWrapper" style="display:none;">
                <div class="border p-2 text-success">Заказ оплачен</div>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn my-button px-5 py-2">Забронировать</button>
            </div>
        </form>
    </div>
</div>


<!-- Модальное окно подтверждения -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-dark text-light rounded-4 shadow-lg">
            <div class="modal-header">
                <h5 class="modal-title">Подтверждение брони</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p><b>Номер заказа:</b> 526356</p>
                <p><b>Дата:</b> <span id="confDate"></span></p>
                <p><b>Время начала:</b> <span id="confTime"></span></p>
                <p><b>Длительность:</b> <span id="confDuration"></span></p>
                <p><b>Место:</b> <span id="confPlace"></span></p>
                <p><b>Автопродление:</b> <span id="confExtend"></span></p>
                <p><b>Тариф:</b> <span id="confTariff"></span></p>
                <p><b>Комментарий:</b> <span id="confComment"></span></p>
                <p><b>Статус оплаты:</b> <span id="confPaymentStatus"></span></p>
                <p><b>Сумма заказа:</b> <span id="confTotal"></span></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='booking.js') }}"></script>
{% endblock %}